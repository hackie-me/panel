<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#1e3a8a">
    <title>Manage Environments</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-blue-50 font-sans text-gray-800">

<header class="bg-blue-600 text-white p-4">
    <div class="container mx-auto flex justify-between items-center">
        <h1 class="text-xl font-bold">Control Panel - Hardik's App</h1>
        <div class="text-sm">Version 1.0</div>
    </div>
    <!-- Add a navigation link to the Environments page -->
    <nav class="bg-blue-600 text-white">
        <div class="container mx-auto">
            <ul class="flex space-x-4 justify-center md:justify-start p-2">
                <li><a href="/" class="hover:underline">Control Panel</a></li>
                <li><a href="/environments" class="hover:underline">Manage Environments</a></li>
                <li><a href="#" onclick="setPath()" class="hover:underline">Add System Path</a></li>
            </ul>
        </div>
    </nav>
</header>

    <main class="p-6">
        <div class="container mx-auto">
            <section>
                <h2 class="text-2xl font-semibold mb-4">Available Environments</h2>
                <table class="min-w-full bg-white shadow-lg rounded-lg">
                    <thead>
                        <tr>
                            <th class="py-2 px-4 border-b">Environment Name</th>
                            <th class="py-2 px-4 border-b">Configuration Value</th>
                            <th class="py-2 px-4 border-b">Actions</th>
                        </tr>
                    </thead>
                    <tbody id="environmentTable">
                        <!-- Dynamic rows will be populated here -->
                    </tbody>
                </table>
            </section>
        </div>
    </main>

    <footer class="bg-blue-600 text-white p-4">
        <div class="container mx-auto text-center text-sm">
            <p>&copy; 2024 by Hardik. All rights reserved.</p>
        </div>
    </footer>

    <script>
        // Fetch and display environments in the table
        async function loadEnvironments() {
            const response = await fetch('/api/environments');
            const environments = await response.json();

            const tableBody = document.getElementById('environmentTable');
            tableBody.innerHTML = ''; // Clear existing rows

            environments.forEach(env => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td class="py-2 px-4 border-b">${env.name}</td>
                    <td class="py-2 px-4 border-b">${env.value.slice(0, 10)}</td>
                    <td class="py-2 px-4 border-b">
                        <button onclick="deleteEnvironment('${env.name}')" class="bg-red-500 text-white py-1 px-3 rounded hover:bg-red-700">
                            Delete
                        </button>
                    </td>
                `;
                tableBody.appendChild(row);
            });
        }

        // Delete environment function
        async function deleteEnvironment(name) {
            const response = await fetch(`/api/environments/${name}`, {
                method: 'DELETE'
            });

            if (response.ok) {
                alert('Environment deleted successfully!');
                loadEnvironments(); // Reload the environment table
            } else {
                alert('Failed to delete environment');
            }
        }

        // Load environments when the page is loaded
        loadEnvironments();

        // Add system path function 
        function setPath() {
            const path = prompt('Enter the system path to add');
            if (path) {
                fetch('/api/setPath', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ folderPath: path })
                }).then(response => {
                    if (response.ok) {
                        alert('System path added successfully!');
                    } else {
                        alert('Failed to add system path');
                    }
                });
            }
        }
    </script>
</body>

</html>